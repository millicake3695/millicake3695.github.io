(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{549:function(t,s,a){"use strict";a.r(s);var e=a(2),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"}),s("p",[t._v("简单介绍了 mysql 的基本操作及一些基本概念。")])]),t._v(" "),s("h3",{attrs:{id:"mysql官方文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql官方文档"}},[t._v("#")]),t._v(" MySQL官方文档")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/sql-statements.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://dev.mysql.com/doc/refman/5.7/en/sql-statements.html"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"gui-tools"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gui-tools"}},[t._v("#")]),t._v(" GUI Tools")]),t._v(" "),s("p",[t._v("Mac OS X: "),s("a",{attrs:{href:"http://www.sequelpro.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("sequelpro"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Windows: "),s("a",{attrs:{href:"https://www.heidisql.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("heidi"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"数据库分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库分类"}},[t._v("#")]),t._v(" 数据库分类")]),t._v(" "),s("ol",[s("li",[t._v("关系型数据库（Sql）- 通过表和表之间，行与列之间的关系进行数据存储")])]),t._v(" "),s("p",[t._v("如 Mysql, Oracle, sqlServer")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("非关系型数据库（NoSql）- 对象存储，通过对象自身的属性来决定")])]),t._v(" "),s("p",[t._v("如 Redis, MongoDB")]),t._v(" "),s("h3",{attrs:{id:"基础命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础命令"}},[t._v("#")]),t._v(" 基础命令")]),t._v(" "),s("ol",[s("li",[s("p",[s("code",[t._v("mysql -utafadmin -ptafadmin2017 -h 10.0.0.1;")]),t._v(" 登录mysql")]),t._v(" "),s("p",[t._v("(1) -u, -p, -h 后紧跟用户名、密码和数据库主机地址，本机可省略 -h 参数。")]),t._v(" "),s("p",[t._v("(2) 命令以分号结尾。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("show databases;")]),t._v(" 显示所有的数据库")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("create database db_name;")]),t._v(" 创建数据库")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("drop database db_name;")]),t._v(" 删除数据库")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("use db_name;")]),t._v(" 进入目标数据库")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("show tables;")]),t._v(" 显示当前数据库全部表")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("drop table table_name if exists;")]),t._v(" 删除表")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("desc table_name;")]),t._v(" 显示表结构")])]),t._v(" "),s("li",[s("p",[t._v("复制粘贴已转储好的全部表结构，执行即可完成导入新表；")])]),t._v(" "),s("li",[s("p",[t._v("select, update, delete, insert 语句执行操作表数据。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("exit;")]),t._v(" 退出")])])]),t._v(" "),s("h3",{attrs:{id:"索引的分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#索引的分类"}},[t._v("#")]),t._v(" 索引的分类")]),t._v(" "),s("p",[t._v("MySQL 把同一个数据表里的索引总数限制为16个。")]),t._v(" "),s("p",[t._v("用途：提高查询效率。")]),t._v(" "),s("p",[t._v("语法：create index 索引名 on 表(字段)")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" idx_table_xxx "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("原则：")]),t._v(" "),s("ul",[s("li",[t._v("索引不是越多越好（占据硬盘空间）")]),t._v(" "),s("li",[t._v("不要对数据进行变动")]),t._v(" "),s("li",[t._v("小数据的表不需要加索引")]),t._v(" "),s("li",[t._v("索引一般加在常用查询、排序的字段")])]),t._v(" "),s("ol",[s("li",[t._v("主键索引")])]),t._v(" "),s("p",[t._v("主键不可重复。定义时使用的关键字是 "),s("code",[t._v("PRIMARY")]),t._v("。")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("唯一索引")])]),t._v(" "),s("p",[t._v("定义时使用的关键字是 "),s("code",[t._v("UNIQUE")]),t._v("。")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("普通索引")])]),t._v(" "),s("p",[t._v("由关键字 "),s("code",[t._v("KEY")]),t._v(" 或 "),s("code",[t._v("INDEX")]),t._v(" 定义的索引。")]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("外键索引")])]),t._v(" "),s("p",[t._v("定义时使用的关键字是 "),s("code",[t._v("foreign key(col_name)")]),t._v("。建立外键的前提是本表的列必须与外键类型相同，同时外键必须是外表主键。")]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[t._v("复合索引")])]),t._v(" "),s("p",[s("code",[t._v("index(colA, colB)")])]),t._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[t._v("全文索引")])]),t._v(" "),s("p",[t._v("关键字 "),s("code",[t._v("FULLTEXT")]),t._v("。InnoDB 数据表不支持全文索引。")]),t._v(" "),s("h3",{attrs:{id:"标准-sql-语句"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#标准-sql-语句"}},[t._v("#")]),t._v(" 标准 sql 语句")]),t._v(" "),s("ol",[s("li",[t._v("查询语句")])]),t._v(" "),s("p",[s("code",[t._v("SELECT param FROM table WHERE condition ORDER BY param1;")])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("新增语句")])]),t._v(" "),s("p",[s("code",[t._v("INSERT INTO table (param1，param) VALUES (value1，value2);")])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("更新语句")])]),t._v(" "),s("p",[s("code",[t._v("UPDATE table SET param=new_value WHERE condition;")])]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("删除语句")])]),t._v(" "),s("p",[s("code",[t._v("DELETE FROM table WHERE condition")])]),t._v(" "),s("h3",{attrs:{id:"一些关键字"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一些关键字"}},[t._v("#")]),t._v(" 一些关键字")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("like")])])]),t._v(" "),s("p",[t._v("模糊查询。")]),t._v(" "),s("p",[s("code",[t._v("like")]),t._v(" 结合 "),s("code",[t._v("%")]),t._v(" 代表0到任意个字符，结合 "),s("code",[t._v("_")]),t._v(" 代表一个字符。")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" table_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" t "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%china'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" table_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" t "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%china%'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" table_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" t "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_china'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[s("code",[t._v("in")])])]),t._v(" "),s("p",[t._v("查询具体的一个或者多个值。")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" table_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" t "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("age "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ol",{attrs:{start:"3"}},[s("li",[s("code",[t._v("inner join")]),t._v(", "),s("code",[t._v("left join")]),t._v(", "),s("code",[t._v("right join")])])]),t._v(" "),s("p",[t._v("联表查询。")]),t._v(" "),s("p",[s("code",[t._v("left join")]),t._v(" (左联接) 返回包括左表中的所有记录和右表中联结字段相等的记录，返回记录条数与左表相同，不足的记录属性用NULL填充"),s("br"),t._v(" "),s("code",[t._v("right join")]),t._v(" (右联接) 返回包括右表中的所有记录和左表中联结字段相等的记录，返回记录条数与右表相同，不足的记录属性用NULL填充"),s("br"),t._v(" "),s("code",[t._v("inner join")]),t._v(" (等值连接) 只返回两个表中联结字段相等的行，不足的记录属性直接舍弃")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" table_a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("left")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" table_b "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" b "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bid "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" condition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ol",{attrs:{start:"4"}},[s("li",[s("code",[t._v("order by")])])]),t._v(" "),s("p",[t._v("排序。"),s("code",[t._v("desc")]),t._v(" 降序， "),s("code",[t._v("asc")]),t._v(" 升序，默认 "),s("code",[t._v("desc")]),t._v("。")]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[s("code",[t._v("limit offset,size")])])]),t._v(" "),s("p",[t._v("分页。")]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" table_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" condition "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("limit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ol",{attrs:{start:"6"}},[s("li",[s("code",[t._v("group by")])])]),t._v(" "),s("p",[t._v("分组。")]),t._v(" "),s("h3",{attrs:{id:"防止-sql-注入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#防止-sql-注入"}},[t._v("#")]),t._v(" 防止 SQL 注入")]),t._v(" "),s("p",[t._v("最佳方案：预编译"),s("code",[t._v("sql")]),t._v("语句。本质是把传递进来的参数当做字符，转义字符被直接转义。")]),t._v(" "),s("p",[t._v("MySQL支持PreparedStatement特性，对SQL进行预编译"),s("br"),t._v("\n调用时将SQL中动态参数用占位符(如?)代替，再将参数单独传递可以很大程度防止SQL注入"),s("br"),t._v("\nNode.js中经常使用的包为"),s("a",{attrs:{href:"https://www.npmjs.com/package/mysql",target:"_blank",rel:"noopener noreferrer"}},[t._v("mysql"),s("OutboundLink")],1),t._v("或"),s("a",{attrs:{href:"https://www.npmjs.com/package/mysql2",target:"_blank",rel:"noopener noreferrer"}},[t._v("mysql2"),s("OutboundLink")],1),t._v("都有相应API")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// mysql")]),t._v("\nconnection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SELECT * FROM `books` WHERE `author` = ?'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'David'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" results"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fields")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// TODO")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// mysql2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rows"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fields"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" connection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SELECT * FROM `table` WHERE `name` = ? AND `age` > ?'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Morty'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("其它：")]),t._v(" "),s("ul",[s("li",[t._v("限制数据库权限")]),t._v(" "),s("li",[t._v("规定数据类型、长度")]),t._v(" "),s("li",[t._v("过滤参数中的一些数据库关键词")])]),t._v(" "),s("h2",{attrs:{id:"insert-update-or-replace选用规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#insert-update-or-replace选用规则"}},[t._v("#")]),t._v(" insert/update or replace选用规则")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"},[t._v("重要的话说前面")]),s("p",[s("strong",[s("font",{attrs:{color:"red"}},[t._v("replace ≠ insert or update")])],1),s("br"),t._v(" "),s("strong",[s("font",{attrs:{color:"red"}},[t._v("replace = insert or (delete + insert)")])],1)])]),s("h3",{attrs:{id:"replace的行为"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#replace的行为"}},[t._v("#")]),t._v(" replace的行为")]),t._v(" "),s("ul",[s("li",[t._v("当表未设置PRIMARY KEY或唯一索引时，replace行为完全等同于insert")]),t._v(" "),s("li",[t._v("当待保存的数据的主键不存在于表中，replace行为完全等同于insert")]),t._v(" "),s("li",[t._v("当待保存的数据的主键已存在于表中，则在插入新行之前删除该旧行，再进行insert")]),t._v(" "),s("li",[t._v("delete和insert作用于同一个事物中，形成一个原子操作")])]),t._v(" "),s("h3",{attrs:{id:"replace的前提"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#replace的前提"}},[t._v("#")]),t._v(" replace的前提")]),t._v(" "),s("ul",[s("li",[t._v("要使用replace必须同时拥有表的insert和delete权限")]),t._v(" "),s("li",[s("font",{attrs:{color:"red"}},[t._v('如果只"更新"部分字段不能使用replace，因为旧行将被删除，只能使用update')])],1)]),t._v(" "),s("h3",{attrs:{id:"replace的返回值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#replace的返回值"}},[t._v("#")]),t._v(" replace的返回值")]),t._v(" "),s("ul",[s("li",[t._v("如果返回1，说明在表中并没有重复的记录")]),t._v(" "),s("li",[t._v("如果返回2，说明有一条重复记录，系统自动先调用了delete删除这条记录，然后再记录用insert来插入这条记录")]),t._v(" "),s("li",[t._v("如果返回值大于2，那说明有多个主键或唯一索引，有多条记录被删除和插入")])])])}),[],!1,null,null,null);s.default=r.exports}}]);